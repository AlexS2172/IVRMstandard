Поддержка ETS ASP на сервере GRAZ
=============================================================
(Доступ через radmin. Адрес 192.168.20.121, пароль shuveepe, пользватель ftuser, пароль jachithi).

Общие принципы:
- Имеется головная БД (имя ETS_ASP_EOD), в которой находится структура контрактов.
  Эта БД регулярно обновляется EOD Manager'ом, установленном на этом сервер.

- Для каждого клиента создаётся отдельная БД с именем ETS_ASP_INST, ETS_ASP_INST_1 и т.д.
  (имена могут быть другими - не принципиально).

- После обновления головной БД на каждой клиентской БД запускается хранимка,
  которая закачивает обновления структуры контрактом и данные с IV из головной БД.

Создание новой клиентской БД:
-----------------------------
1. Восстановить бэкап "D:\DATA\MSSQL\BACKUP\ETS_ASP_INST.GRAZ.2004.07.08.bak" в новую БД
   (Доступ к БД будет с логином asp и паролем asp)

2. Добавить новых NT-пользователей (столько, сколько нужно) в группу Users на сервер,
   добавить их всех в группу ETS (для доступа через citrix)

3. Изменить файл "D:\FT\ASP Support\ASP_User_Settings.reg" по следующей схеме
   - в секцию [HKEY_LOCAL_MACHINE\SOFTWARE\Egar\ETS\Asp\Database] добавить новую запись со строкой соединения к новой базе:
     "<Имя клиента>"="Provider=SQLOLEDB.1;Data Source=(local);Initial Catalog=<Имя клиентcкой БД>;User ID=asp;Password=asp;Persist Security Info=False"
   - в секцию [HKEY_LOCAL_MACHINE\SOFTWARE\Egar\ETS\Asp] для каждого созданного NT-пользователя добавить запись:
     "<Имя пользователя>"="<Имя клиента>"
     ("<Имя клиента>" здесь должно совадать с именем в предыдущей секции)

4. Занести файл "D:\FT\ASP Support\ASP_User_Settings.reg" в реестр.

5. На вновь созданной базе запустить хранимку usp_AspEodUpdateMarketStructure_Execute (без параметров)
   для первоначального обновления структуры контрактов из головной БД

6. С помощью EtsBO через citrix с новым логином настроить списки трейдеров, стратегий и т.п. (если необходимо)

Обновление головной БД:
-------------------------
Производится ежедневно из EOD Manager'а.
Можно в ручную из консоли radmin, можно настроить расписание.
(Доступ к БД с логином eod и паролем eod)

Обновление клиентской БД:
-------------------------
Каждая клиентская БД обновляется из головной БД с помощью запуска
хранимки usp_AspEodUpdateMarketStructure_Execute (без параметров) из консоли radmin.
Пока предполагается делать это вручную, после тестирования будет создан
соответствующий job. Обновление нужно выполнять после того,
как завершилось обновление головной БД из EOD Manager'а.

Конфигурация:
-------------
- Установленная базовая версия ETS 2.1.422
  (находится в "D:\FT\ETS Setup")

- Вручную заменеы некоторые модули для ASP (пока нет отдельного сетапа для ETS ASP)
  (находятся в "D:\FT\ASP Support\bin\")

Дополнительно:
--------------
В случае добавления нового стока/индекса/фьючерсного рута в одной из клиентких БД
необходимо добавить его в головную БД для включения его в процесс апдейта.
Это производится с помощью скрипта "D:\FT\ASP Support\ETS_ASP_EOD_Intermediate_Fill_Contracts.sql",
который прогоняется на головной БД. Перед его запуском нехобходимо заменить адрес клиентской базы
во всех местах, где он встречается в этом скрипте.




